# based on digitalocean.com's content 
# "How To Use HAProxy to Set Up HTTP Load Balancing on an Ubuntu VPS"
# @see https://www.digitalocean.com/community/tutorials/how-to-use-haproxy-to-set-up-http-load-balancing-on-an-ubuntu-vps
global
  daemon
  log 127.0.0.1 local0 notice
  maxconn 2048

defaults
  log global
  mode http
  option httplog
  option dontlognull
  retries 3
  option redispatch
  timeout connect 5000
  timeout client 10000
  timeout server 10000
  # haproxy status check URI
  stats enable
  stats uri /haproxy?stats
  stats auth iamuser:on!yforte$t
  
frontend http-in
  mode http 
  bind "*:${PORT_HTTP}"
  
  acl is_website hdr(host) "${HDR_HOST_APP_URL}"
  acl is_phpmyadmin hdr(host) "${HDR_HOST_PHPMYADMIN_URL}"

  use_backend website if is_website
  use_backend phpmyadmin if is_phpmyadmin

backend website 
  mode http 
  server app "${BACKEND_APP_SERVER_ADDR}"

backend phpmyadmin
  mode http 
  server phpmyadmin "${BACKEND_PHPMYADMIN_SERVER_ADDR}"